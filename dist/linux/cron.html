<!DOCTYPE html><html lang="zh-CN" prefix="og: http://ogp.me/ns#"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Cron 定时任务 - Linux 教程 - 网道</title><!-- link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" --><link rel="stylesheet" href="assets/css/app.min.css"><link rel="stylesheet" href="https://apps.bdimg.com/libs/fontawesome/4.4.0/css/font-awesome.css"><!-- link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css"--><!-- link rel="stylesheet" href="assets/css/share.min.css" --><meta property="og:type" content="article"><meta property="og:title" content="Cron 定时任务"><link rel="apple-touch-icon" href="assets/icons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="192x192" href="assets/icons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="assets/icons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png"><link rel="manifest" href="assets/icons/manifest.json"></head><body><nav class="navbar is-light" role="navigation" id="navbar" aria-label="main navigation"><div class="container"><div class="navbar-brand"><a href="/" class="navbar-item title has-text-grey has-text-weight-light is-5">网道 / WangDoc.com </a><a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false"><span aria-hidden="true"></span> <span aria-hidden="true"></span> <span aria-hidden="true"></span></a></div><div class="navbar-menu" id="navMenu"><div class="navbar-end"><div class="navbar-item"><form action="https://sourcegraph.com/search" target="_blank" method="get" onsubmit='this.q.value="repo:^github.com/wangdoc/linux-tutorial$ "+this.origin.value'><p class="control has-icons-right"><input class="input" type="text" name="origin" placeholder="搜索..."> <span class="icon is-small is-right"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="#ddd" d="M23.822 20.88l-6.353-6.354c.93-1.465 1.467-3.2 1.467-5.059.001-5.219-4.247-9.467-9.468-9.467s-9.468 4.248-9.468 9.468c0 5.221 4.247 9.469 9.468 9.469 1.768 0 3.421-.487 4.839-1.333l6.396 6.396 3.119-3.12zm-20.294-11.412c0-3.273 2.665-5.938 5.939-5.938 3.275 0 5.94 2.664 5.94 5.938 0 3.275-2.665 5.939-5.94 5.939-3.274 0-5.939-2.664-5.939-5.939z"/></svg></span></p><input type="hidden" name="q" value=""> <input type="hidden" name="patternType" value="literal"></form></div><a class="navbar-item is-hidden-desktop-only" target="_blank" href="https://github.com/wangdoc/linux-tutorial"><span class="icon" style="color: #333;"><i class="fa fa-lg fa-github"></i></span></a></div></div></div></nav><section class="section main article"><div class="container"><div class="columns"><div class="column is-8 is-6-widescreen is-offset-1-widescreen"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="index.html"><span class="icon"><i class="fa fa-home"></i></span> &nbsp;Linux 教程</a></li><li class="is-active"><a class="has-text-grey" href="cron.html">Cron 定时任务</a></li></ul></nav><nav class="level level-previous-next is-mobile"><!-- Left side --><div class="level-left"><p class="level-item is-narrow"><a href="user.html"><span class="icon"><i class="fa fa-toggle-left"></i></span> 用户管理</a></p></div><div class="level-right"><p class="level-item is-narrow"><a href="systemd.html">SystemD <span class="icon"><i class="fa fa-toggle-right"></i></span></a></p></div></nav><article class="content"><h1 class="title">Cron 定时任务</h1><div class="page-meta"><p>网道（WangDoc.com），互联网文档计划</p></div><h2 id="简介">简介 <a class="markdownIt-Anchor" href="#简介">#</a></h2><p>Cron 是一个用来执行定时任务的工具，可以在指定的时间自动执行重复性任务。</p><p>它的核心是 cron 守护进程，名为 crond。它在后台每分钟运行一次，检查是否有需要在指定时间执行的计划任务。</p><p>下面命令可以查看 cron 守护进程，是否正常运行。</p><pre class="hljs"><code>$ <span class="hljs-built_in">sudo</span> systemctl status cron
</code></pre><h2 id="crontab">crontab <a class="markdownIt-Anchor" href="#crontab">#</a></h2><p>crond 检查的定时任务，保存在 crontab 文件。该文件的每一行代表一个单独的作业，包含何时运行该任务，以及所要执行的命令。</p><p>crontab 分成两个级别：用户个人的crontab，系统的 crontab。前者由用户本人编辑，后者只能由根用户编辑。</p><p>系统的 crontab 存放在<code>/etc/crontab</code>，以及一系列特殊目录之中：<code>/etc/cron.daily</code>、<code>/etc/cron.hourly</code>、<code>/etc/cron.weekly</code>和<code>/etc/cron.monthly</code>。</p><h2 id="cron-任务的语法">cron 任务的语法 <a class="markdownIt-Anchor" href="#cron-任务的语法">#</a></h2><p>crontab 文件的每一行，代表一个 cron 任务。它由多个字段组成，字段之间使用空格或制表符分隔。</p><p>cron 任务的基本语法如下。</p><pre class="hljs"><code>minute hour day_of_month month day_of_week command_to_execute
</code></pre><p>各个字段的含义如下。</p><ul><li>minute（0-59）：指定命令运行的分钟，可以是0到59之间的值，0表示将在一小时开始时运行命令。</li><li>hour（0-23）：指定命令运行的小时，以24小时格式指定，例如将其设置为14将在下午2点运行该命令。</li><li>day_of_month（1-31）：指定命令运行的日期。它可以是1到31之间的任意值，具体取决于该月的天数。例如，设置为1将在每个月的第一天运行命令。</li><li>month（1-12）：指定命令将在哪个月份执行。它可以是 1（一月）到 12（十二月）之间的值。例如，设置为12将在12月执行该命令。</li><li>day_of_week（0-6）：指定命令应在一周中的哪一天运行。它可以是0（星期日）到6（星期六）之间的值。例如，设置为5将在每个星期五运行该命令。</li><li>command_to_execute：指定 cron 任务应执行的操作。</li></ul><p>crontab 还允许使用通配符。</p><ul><li>星号 (<em>)：代表“每个”时间单位。例如，小时字段中的“</em>”表示“每小时”。</li><li>逗号 (,)：用于在同一字段指定多个值。例如，day_of_week 字段中的“1,3,5”表示“周一、周三和周五运行”。注意，逗号前后不能由空格。</li><li>连字符 (-)：指定值的范围。例如，小时字段中的“9-17”表示“上午9点到下午5点之间的每小时”。</li><li>斜杠 (/)：指定增量。例如，分钟字段中的“*/10”表示“每10分钟”。</li></ul><p>crontab 还提供一些快捷字符串。</p><ul><li>@reboot	在启动时运行一次指定的命令 。</li><li>@year，@annually 两者都在每年 1 月 1 日中午 12:00运行指定的任务 。相当于指定“0 0 1 1 *”</li><li>@monthly 每月1 日中午 12:00运行该作业 一次。相当于“0 0 1 <em></em>”</li><li>@weekly 在每周周日中午 12:00运行该作业 一次。相当于“0 0 <em></em> 0”</li><li>@daily，@midnight：两者都在每天中午 12:00运行 cronjob 。这相当于在 crontab 文件中指定“0 0 <em></em> *”。</li><li>@hourly：每小时整点运行该作业 。相当于“0 <em></em> <em></em>”</li></ul><p>crontab 文件中，以“#”符号开头的行表示注释。</p><p>以下是一些示例。</p><ul><li><code>* * * * *</code>	每分钟运行一次 cron 作业。</li><li><code>0 * * * *</code>	每小时运行一次 cron 作业。</li><li><code>0 0 * * *</code>	每天午夜运行 cron 作业。</li><li><code>0 2 * * *</code>	每天凌晨 2 点运行 cron 作业。</li><li><code>0 0 15 * *</code>	每个月 15 日午夜运行一次 cron 作业。</li><li><code>0 0 0 12 *</code>	周六午夜运行 cron 作业。</li><li><code>0 0 * * 6</code>	从周一到周五每天下午 3 点运行 cron 作业。</li><li><code>0 15 * * 1-5</code>	从周一到周五每天下午 3 点运行 cron 作业。</li><li><code>*/5 * * * *</code>	每 5 分钟运行一次 cron 作业。</li><li><code>0 8-16 * * *</code> 每天、每小时、从上午 8 点到下午 4 点准时执行 cron 作业。</li><li><code>0 4 * * 2,4</code>	在周二和周四凌晨 4 点运行 cron 作业。</li><li><code>@reboot</code>	系统启动时运行 cron 作业。</li></ul><h3 id="环境变量">环境变量 <a class="markdownIt-Anchor" href="#环境变量">#</a></h3><p>cron 任务在非交互式、非登录 Shell 环境中运行，这意味着它们可能无法访问与手动运行命令时相同的环境变量。</p><p>这就是说，cron 任务不会自动继承用户或系统的环境变量或路径。这可能会导致 cron 作业失败，无法找到可执行文件或脚本。解决方法是在 crontab 文件中显式设置 PATH 环境变量。</p><pre class="hljs"><code>PATH=/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin
</code></pre><p>不过，为了便于调试，建议始终在 cron 任务中使用绝对路径。</p><p>除了<code>PATH</code>环境变量，还可以设置<code>SHELL</code>环境变量，指定 cron 使用的 Shell。</p><pre class="hljs"><code>SHELL=/bin/sh
</code></pre><p>上面示例设定执行 cron 任务时，使用 Bash。</p><h2 id="cron-任务管理">cron 任务管理 <a class="markdownIt-Anchor" href="#cron-任务管理">#</a></h2><h3 id="个人任务">个人任务 <a class="markdownIt-Anchor" href="#个人任务">#</a></h3><p>创建或编辑用户的 crontab 文件，使用下面的命令。</p><pre class="hljs"><code>crontab -e
</code></pre><p>上面的命令会打开系统默认文本编辑器，对用户的 crontab 文件进行编辑。</p><p>添加 cron 任务，只需在 crontab 文件中添加一个新行即可。例如，备份脚本 backup.sh 每天凌晨 3:00 运行，就是添加下面的内容。</p><pre class="hljs"><code>0 3 * * * /home/linuxiac/backup.sh
</code></pre><p>编辑完成后，保存并退出编辑器。Cron 服务会自动检查 crontab 文件，因此无需在更改后重新启动 Cron 进程。</p><p><code>crontab -e</code>还会在保存和退出文件时，自动检查语法，防止意外输入无效的 cron 任务。</p><p>下面命令可以列出当前用户的所有 cron 任务。</p><pre class="hljs"><code>$ crontab -l
</code></pre><p>如果拥有根用户权限，可以查看其他用户的 cron 任务。</p><pre class="hljs"><code>$ <span class="hljs-built_in">sudo</span> crontab -u [用户名] -l
</code></pre><p>上面示例中，<code>[用户名]</code>是需要替换的部分。</p><p>编辑其他用户的 cron 任务，可以使用命令行参数<code>-e</code>。</p><pre class="hljs"><code>$ <span class="hljs-built_in">sudo</span> crontab -u [用户名] -e
</code></pre><p>删除某个 cron 任务时，只要删除那一行即可。如果想要删除所有的 cron 任务，只要删除 crontab 文件即可，也可以使用命令行参数<code>-r</code>。</p><pre class="hljs"><code>$ crontab -r
</code></pre><p>上面的命令会删除当前用户的 crontab 文件（即删除所有 cron 任务），而且不会出现任何确认提示，因此请小心使用。</p><p>如果希望删除前出现确认提示，则可以使用命令行参数<code>-i</code>。</p><pre class="hljs"><code>$ crontab -i -r
</code></pre><h3 id="系统任务">系统任务 <a class="markdownIt-Anchor" href="#系统任务">#</a></h3><p>创建系统级别的 cron 任务，需要直接编辑<code>/etc/crontab</code>文件。</p><pre class="hljs"><code>0  2  *  *  * root /usr/bin/find /var/log/myservice -<span class="hljs-built_in">type</span> f -name <span class="hljs-string">&#x27;*.log&#x27;</span> -delete
</code></pre><p>上面示例设定在每天凌晨2:00，从<code>/var/log/myservice</code>目录删除所有带有扩展名为<code>.log</code>的文件。</p><p>它的格式与用户级别的 cron 文件有一个区别，就是在最初表示时间的五个字段后面，多了一个字段，表示执行任务的用户帐户，本例为<code>root</code>。</p><p>直接编辑<code>/etc/crontab</code>文件有两个缺点。（1）它不提供语法检查，增加了出错的风险。（2）它会影响整个系统，使用时需要非常谨慎。</p><p>列出所有的系统级别 cron 任务，需要查看以下所有文件和目录。</p><ul><li>/etc/crontab 文件</li><li>/etc/cron.d/ 目录</li><li>/etc/cron.daily/ 目录</li><li>/etc/cron.hourly/ 目录</li><li>/etc/cron.weekly/ 目录</li><li>/etc/cron.monthly/ 目录</li></ul><h2 id="参考链接">参考链接 <a class="markdownIt-Anchor" href="#参考链接">#</a></h2><ul><li><a href="https://linuxiac.com/how-to-use-cron-and-crontab-on-linux/" target="_blank" rel="noopener">How to Use Cron on Linux: Tips, Tricks, and Examples</a></li></ul></article><nav class="level level-previous-next is-mobile"><!-- Left side --><div class="level-left"><p class="level-item is-narrow"><a href="user.html"><span class="icon"><i class="fa fa-toggle-left"></i></span> 用户管理</a></p></div><div class="level-right"><p class="level-item is-narrow"><a href="systemd.html">SystemD <span class="icon"><i class="fa fa-toggle-right"></i></span></a></p></div></nav><div class="page-info"><p>本教程采用<a href="https://creativecommons.org/licenses/by-sa/3.0/deed.zh" target="_blank">知识共享 署名-相同方式共享 3.0协议</a>。</p><p>分享本文 <span class="social-share"></span></p></div></div><div class="column is-3 is-offset-1"><nav class="panel panel-menu is-light"><p class="panel-heading"><i class="fa fa-book" aria-hidden="true"></i> Linux 教程</p><div class="panel-block"><aside class="menu"><p class="menu-label"></p><ul class="menu-list"><li><a href="intro.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">Linux 介绍</span></a></li><li><a href="user.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">用户管理</span></a></li><li><a href="cron.html" class="is-active"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">Cron 定时任务</span></a></li><li><a href="systemd.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">SystemD</span></a></li><li><a href="xargs.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">xargs 命令</span></a></li><li><a href="distro/index.html"><span class="icon"><i class="fa fa-caret-down"></i> </span><i class="fa folder fa-folder-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">发行版</span></a><ul><li><a href="distro/arch.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">Arch Linux</span></a></li><li><a href="distro/fedora.html"><span class="icon"></span> <i class="fa fa-file-text-o" aria-hidden="true" style="width: 14px;"></i> &nbsp; <span class="menu-list-title">Fedora</span></a></li></ul></li></ul></aside></div></nav><nav class="panel panel-info is-light"><p class="panel-heading"><i class="fa fa-link" aria-hidden="true"></i> 链接</p><div class="panel-block"><aside class="menu"><p class="menu-label"></p><ul class="menu-list"><li><a href="https://raw.githubusercontent.com/wangdoc/linux-tutorial/main/docs/cron.md" target="_blank"><span class="icon"></span><i class="fa fa-code" aria-hidden="true" style="width: 14px;"></i>&nbsp;本文源码</a></li><li><a href="https://github.com/wangdoc/linux-tutorial" target="_blank"><span class="icon"></span><i class="fa fa-hdd-o" aria-hidden="true" style="width: 14px;"></i>&nbsp;代码仓库</a></li><li><a href="https://github.com/wangdoc/linux-tutorial/issues" target="_blank"><span class="icon"></span><i class="fa fa-flag-o" aria-hidden="true" style="width: 14px;"></i>&nbsp;反馈</a></li></ul></aside></div></nav></div></div><div class="columns"><div class="column is-8 is-6-widescreen is-offset-1-widescreen"><div id="disqus_thread"></div></div></div></div></section><footer class="footer"><div class="container"><div class="content has-text-centered"><p>联系：contact@wangdoc.com</p></div></div></footer><script>var LOPPO={current_path:"cron.md",relative_root_path:"",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li>\n<li><a href="#crontab">crontab</a></li>\n<li><a href="#cron-%E4%BB%BB%E5%8A%A1%E7%9A%84%E8%AF%AD%E6%B3%95">cron 任务的语法</a>\n<ul>\n<li><a href="#%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F">环境变量</a></li>\n</ul>\n</li>\n<li><a href="#cron-%E4%BB%BB%E5%8A%A1%E7%AE%A1%E7%90%86">cron 任务管理</a>\n<ul>\n<li><a href="#%E4%B8%AA%E4%BA%BA%E4%BB%BB%E5%8A%A1">个人任务</a></li>\n<li><a href="#%E7%B3%BB%E7%BB%9F%E4%BB%BB%E5%8A%A1">系统任务</a></li>\n</ul>\n</li>\n<li><a href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">参考链接</a></li>\n</ul>\n'}</script><script src="assets/js/app.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-111269443-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-111269443-1")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script"),t=(e.src="https://hm.baidu.com/hm.js?5eec262881855af3dede6a71234571f6",document.getElementsByTagName("script")[0]);t.parentNode.insertBefore(e,t)}()</script><script>var disqus_config=function(){var t=window.location,e=t.protocol+"//"+t.host+(t.port?":"+t.port:"")+t.pathname;this.page.url=e,this.page.identifier=t.pathname};!function(){var t=document,e=t.createElement("script");e.src="https://wangdoc-linux.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><!--script src="assets/js/social-share.min.js"--><!--/script--><script>var shareDesc="我正在阅读《Cron 定时任务》，出自网道（WangDoc.com）的《Linux 教程》。",shareOpts={url:window.location.href,source:shareDesc,title:shareDesc,description:"",image:"",sites:["weibo","wechat","qq","qzone","twitter","facebook"],origin:"WangDoc_com",disabled:[],wechatQrcodeTitle:"微信",wechatQrcodeHelper:"扫一下二维码，分享到微信。"};socialShare(".social-share",shareOpts)</script></body></html>